# 工时管理小程序前端技术方案

## 1. 项目概述

本技术方案旨在构建一个**丝滑、简约、高效**的工时管理小程序。项目基于 **Taro + React** 技术栈，支持多端（重点是微信小程序）发布。核心目标是实现组织管理、项目管理、工时记录与统计、成本核算等功能，为用户提供流畅的操作体验。

## 2. 技术选型

### 2.1 核心框架
*   **跨端框架**: [Taro v3.6+](https://taro-docs.jd.com/)
    *   选择理由：成熟的 React 跨端解决方案，社区活跃，性能优秀，支持 Hooks。
*   **UI 视图库**: React 18+
    *   选择理由：主流前端框架，组件化开发，Hooks 逻辑复用。

### 2.2 UI 组件库 & 设计风格
*   **组件库**: **NutUI React** (京东风格)
    *   选择理由：
        *   专为移动端设计，组件丰富（70+）。
        *   风格现代、轻量，符合“丝滑简约”的要求。
        *   支持按需加载，包体积小。
        *   提供良好的 TypeScript 支持。
*   **图表库**: **F2** (AntV F2) 或 **ECharts for Weixin**
    *   选择理由：移动端专用图表库，性能好，交互流畅，适合统计模块的图表展示。
*   **样式方案**: **SCSS + CSS Modules**
    *   选择理由：
        *   SCSS 提供变量、嵌套等预处理能力。
        *   CSS Modules 避免样式冲突，利于组件化维护。
        *   配合 `classnames` 库动态管理类名。

### 2.3 状态管理 & 数据流
*   **状态管理**: **Zustand**
    *   选择理由：
        *   极简、轻量（<1KB），API 友好 (Hooks 风格)。
        *   去中心化状态管理，适合小程序场景，避免 Redux 的样板代码。
        *   易于持久化（Persist middleware）。
*   **数据请求**: **Taro.request 封装**
    *   选择理由：原生 API 封装，统一处理拦截器、Token 注入、错误处理、Loading 状态。

### 2.4 工具库
*   **时间处理**: **Day.js** (轻量级，替代 Moment.js)
*   **工具函数**: **Lodash-es** (按需引入)
*   **类型检查**: **TypeScript** (强类型保障)

### 2.5 技术选型对比决策
为了确保选型的合理性，以下是主要技术点的对比分析：

#### 2.5.1 状态管理 (State Management)
| 方案 | 优点 | 缺点 | 适用场景 | 结论 |
| :--- | :--- | :--- | :--- | :--- |
| **Zustand** | **极简 (Hooks 风格)**，无样板代码，体积小 (<1KB)，易于持久化，性能优异。 | 生态圈不如 Redux 庞大，但对小程序已足够。 | 中小型项目，追求开发效率和性能。 | **✅ 选用** |
| **Redux Toolkit** | 行业标准，调试工具强大，生态最丰富。 | **样板代码多**，学习曲线陡峭，对小程序显得过重。 | 大型企业级应用，团队多人协作。 | ❌ 不选 |
| **Context API** | React 原生，无需引入第三方库。 | 性能优化困难 (Context Hell)，状态追踪不便。 | 仅需传递少量全局配置的极简应用。 | ❌ 不选 |

> **决策理由**：本项目追求“轻量、高效”，Zustand 的 Hooks 风格与 React 18 完美契合，且代码量远少于 Redux，非常适合小程序场景。

#### 2.5.2 UI 组件库 (Component Library)
| 方案 | 优点 | 缺点 | 适用场景 | 结论 |
| :--- | :--- | :--- | :--- | :--- |
| **NutUI React** | **京东出品**，专注移动端电商风格，组件丰富 (70+)，Taro 适配性极佳，TS 支持好。 | 社区资源略逊于 AntD，但官方维护积极。 | 移动端商城、工具类小程序。 | **✅ 选用** |
| **Taro UI** | Taro 官方出品，兼容性理论最强。 | **组件数量较少**，更新频率低，设计风格较旧。 | 简单的 Taro 演示项目。 | ❌ 不选 |
| **Ant Design Mobile** | 阿里系设计语言，交互细节打磨极好。 | **主要面向 H5**，虽然有 Taro 适配版但存在兼容性坑 (如样式隔离问题)。 | 纯 H5 项目或阿里系内部项目。 | ❌ 不选 |

> **决策理由**：NutUI React 是目前 Taro 生态中维护最活跃、组件最丰富的库之一，且设计风格现代简约，符合“丝滑简约”的 UI 要求。

## 3. 系统架构设计

### 3.1 目录结构
```text
src/
├── assets/             # 静态资源（图片、图标、字体）
├── components/         # 公共组件（底部导航、自定义头部、空状态、加载骨架屏）
├── constants/          # 常量定义（API地址、枚举值、配置项）
├── hooks/              # 自定义 Hooks (useAuth, useRequest, usePermission)
├── pages/              # 页面文件
│   ├── home/           # 首页/工作台
│   ├── project/        # 项目管理相关
│   ├── work-hour/      # 工时记录相关
│   ├── stats/          # 统计报表
│   └── mine/           # 个人中心/组织管理
├── services/           # API 服务层 (按模块划分: auth, project, work-hour)
├── store/              # 全局状态 (userStore, orgStore, globalStore)
├── styles/             # 全局样式 (variables.scss, mixins.scss)
├── utils/              # 工具函数 (request.ts, format.ts, validation.ts)
└── app.config.ts       # 全局配置
```

### 3.2 交互设计原则（丝滑简约）
1.  **转场动画**: 页面跳转使用原生推入/弹出效果；Tab 切换增加轻微渐变或滑动反馈。
2.  **骨架屏 (Skeleton)**: 数据加载过程中使用骨架屏占位，避免页面闪烁，提升感知速度。
3.  **触觉反馈**: 在关键操作（如打卡成功、保存成功、长按）加入 `Taro.vibrateShort()` 震动反馈。
4.  **手势操作**: 支持左滑删除（虽然 V1 不删工时，但可用于移除成员）、下拉刷新、日历左右滑动切换月份。
5.  **简约视觉**:
    *   大量使用留白（Whitespace）。
    *   统一主色调（建议使用品牌色，如深蓝或科技蓝），辅助色主要为灰度色阶。
    *   卡片式布局（Card UI），阴影轻柔。

## 4. 核心模块实现方案

### 4.1 用户与权限 (Auth & Permission)
*   **登录流程**: 手机号+验证码登录 -> 获取Token -> 存储 Token 到 Storage -> 初始化用户信息 & 组织信息。
*   **权限控制**:
    *   基于 `usePermission` Hook，根据当前用户在当前组织/项目的角色（Owner/Admin/Member）控制按钮显示/隐藏。
    *   路由拦截：在页面 `useDidShow` 或封装的高阶组件中检查权限，无权限重定向至 403 页或提示。

### 4.2 工时管理 (Work Hours)
*   **日历视图**:
    *   使用自定义日历组件（基于 NutUI Calendar 改造）。
    *   日历上通过小圆点颜色标识状态（如：已填、工时不足、超时）。
    *   支持左右滑动切换月份，点击日期弹出当日工时列表浮层（Bottom Sheet）。
*   **工时填报**:
    *   表单页使用 NutUI Form。
    *   **智能默认值**: 自动带入上次选择的项目、最近常选的项目成员。
    *   **实时校验**: 输入工时数时实时计算当日总工时，防止超过 24h。

### 4.3 统计图表 (Statistics)
*   **图表选型**:
    *   **饼图**: 展示项目工时占比、成员工时占比。
    *   **柱状图**: 展示每日/每周工时趋势。
    *   **折线图**: 展示成本变化趋势。
*   **性能优化**: 图表组件延迟加载，避免阻塞主线程；数据量大时开启图表缩放（DataZoom）。

### 4.4 组织与项目 (Org & Project)
*   **组织切换**: 顶部导航栏或侧边栏提供组织切换器，切换后刷新全局 `orgStore`，触发所有关联数据重新获取。
*   **列表加载**: 实现长列表虚拟滚动（Virtual List），应对大量成员或项目的场景。

## 5. 服务端交互规范

### 5.1 接口规范
*   遵循 RESTful 风格。
*   **统一响应格式**:
    ```json
    {
      "code": 200,      // 业务状态码，200成功，非200失败
      "data": { ... },  // 业务数据
      "message": "success" // 提示信息
    }
    ```

### 5.2 请求封装 (Request)
*   **Token 注入**: Header 中统一添加 `Authorization: Bearer {token}`。
*   **组织上下文**: Header 中统一添加 `X-Org-ID: {currentOrgId}`，后端自动识别当前操作组织。
*   **异常处理**:
    *   401: Token 过期，自动清除本地状态并跳转登录页。
    *   403: 无权限，Toast 提示。
    *   500: 服务端错误，友好提示“系统繁忙”。
    *   网络异常: 提示“网络连接失败”。

## 6. 开发环境与构建
*   **包管理**: pnpm (推荐) 或 yarn。
*   **代码规范**: ESLint + Prettier + Husky (提交前校验)。
*   **多环境**:
    *   `.env.development`: 开发环境 API
    *   `.env.production`: 生产环境 API

## 7. 总结
本方案采用成熟稳健的 **Taro + React** 技术栈，配合 **NutUI** 打造现代化 UI。通过 **Zustand** 管理复杂的状态逻辑（组织切换、权限变更），利用 **TypeScript** 保证代码质量。重点关注**用户体验**，通过骨架屏、流畅动画和简约设计，实现“丝滑”的工时管理工具。
