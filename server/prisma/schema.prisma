
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id        String   @id @default(uuid())
  phone     String   @unique
  name      String?
  password  String
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  ownedOrgs Organization[] @relation("OrgOwner")
  memberships OrganizationMember[]
}

model Organization {
  id          String   @id @default(uuid())
  name        String
  description String?
  ownerId     String
  owner       User     @relation("OrgOwner", fields: [ownerId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  members     OrganizationMember[]
  projects    Project[]
}

model OrganizationMember {
  id          String   @id @default(uuid())
  orgId       String
  organization Organization @relation(fields: [orgId], references: [id])
  
  userId      String?
  user        User?    @relation(fields: [userId], references: [id])

  // Snapshot of employee info in this org
  name        String
  phone       String
  role        String   @default("member") // owner, leader, member, temp
  wageType    String   @default("day") // day, month, hour
  wageAmount  Float    @default(0)
  birthday    String?
  
  status      String   @default("active") // pending, active, disabled

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workRecords WorkRecord[]
  
  // Ensure unique phone per org? Or unique user per org.
  @@unique([orgId, userId])
}

model Project {
  id          String   @id @default(uuid())
  orgId       String
  organization Organization @relation(fields: [orgId], references: [id])
  
  name        String
  description String?
  status      String   @default("active") // active, completed
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workRecords WorkRecord[]
}

model WorkRecord {
  id          String   @id @default(uuid())
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id])
  
  memberId    String
  member      OrganizationMember @relation(fields: [memberId], references: [id])
  
  date        String // YYYY-MM-DD
  duration    Float
  content     String?
  
  // Snapshot of wage at the time of record
  wageSnapshot     Float
  wageTypeSnapshot String
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
