# 统计与成本模块（Statistics & Cost Module）— V1

> 本模块用于在【组织】与【项目】维度下，对工时、人员、成本进行统计分析，为组织负责人和项目负责人提供决策依据。
> 本模块 **强依赖工时记录模块与员工管理模块**。

---

## 1. 模块目标

* 清晰回答以下核心问题：

  * 某个项目 / 组织 **用了多少工时**？
  * 哪些员工 **投入最多**？
  * **人力成本是多少**？
  * 成本主要集中在哪些项目 / 时间段？
* 支持 **按组织 / 项目 / 人员 / 时间** 多维度统计
* V1 以 **统计展示为主，不做预测和复杂分析**

---

## 2. 统计维度设计

### 2.1 核心统计维度

| 维度   | 说明             |
| ---- | -------------- |
| 组织   | 当前登录并切换的组织     |
| 项目   | 项目级别统计（最重要）    |
| 成员   | 员工 / 成员维度      |
| 时间   | 日 / 周 / 月 / 年  |
| 工时类型 | 普通工时（V1 仅支持一种） |

---

## 3. 工时统计模块

### 3.1 组织级工时统计

**统计内容**：

* 组织总工时
* 统计周期内每日 / 每月工时趋势
* 项目工时占比

**典型指标**：

* 总工时（小时）
* 活跃项目数
* 活跃员工数

---

### 3.2 项目级工时统计（核心）

**支持按项目查看**：

* 项目累计总工时
* 项目周期内工时趋势
* 成员工时贡献排行

**说明**：

* 即使项目已结束，仍可持续查看历史统计
* 项目成员被移除后，其历史工时 **仍计入项目统计**

---

### 3.3 成员工时统计

**支持查看某个成员**：

* 在组织内累计工时
* 在各项目中的工时分布
* 时间维度工时变化

**注意**：

* 成员被移出组织后：

  * 历史统计仍保留
  * 不再参与未来统计

---

## 4. 成本计算模块

> 成本 = 工时 × 员工工资规则

### 4.1 工资类型支持（来自员工管理模块）

| 工资类型 | 说明      | 成本计算方式          |
| ---- | ------- | --------------- |
| 时薪   | 每小时固定金额 | 工时 × 时薪         |
| 日薪   | 每天固定金额  | 工时 ÷ 标准日工时 × 日薪 |
| 月薪   | 每月固定金额  | 工时 ÷ 标准月工时 × 月薪 |

> 标准日工时 / 月工时：
>
> * V1 采用系统默认值（如：8h / 160h）
> * 后续版本支持组织级配置

---

### 4.2 成本统计维度

#### 4.2.1 项目成本

* 项目总人力成本
* 成本随时间变化
* 成员成本占比

#### 4.2.2 组织成本

* 组织总人力成本
* 项目成本分布

#### 4.2.3 成员成本

* 某成员累计人力成本
* 在不同项目中的成本贡献

---

## 5. 成本统计与工时统计的关系

* 工时是 **基础事实数据**
* 成本是 **派生计算结果**
* 修改以下数据会影响历史成本：

  * 员工工资类型 / 金额（是否影响历史：V1 默认影响全部）

> V2 可支持「工资版本化」，避免历史成本变化

---

## 6. 权限与可见性

### 6.1 组织负责人

* 可查看组织内所有统计数据
* 可查看所有项目、所有成员的成本

### 6.2 项目负责人

* 仅可查看负责项目的统计与成本
* 不可查看其他项目数据

### 6.3 普通成员

* 可查看：

  * 自己的工时统计
  * 自己参与项目的基础统计（不含他人成本）

---

## 7. 典型使用场景

### 场景 1：项目复盘

> 想知道「这个项目到底花了多少人力」

* 进入项目详情 → 统计页
* 查看项目总工时 & 总成本
* 查看成员工时 / 成本排行

---

### 场景 2：组织管理

> 想知道「今年人力主要花在哪些项目」

* 进入组织统计页
* 查看项目成本占比
* 按月查看趋势

---

## 8. V1 明确不做的内容

* ❌ 成本预算 / 超支预警
* ❌ 工时预测
* ❌ 多币种 / 税务处理
* ❌ 财务审批流

---

## 9. 与其他模块的依赖关系

| 模块     | 依赖关系   |
| ------ | ------ |
| 组织模块   | 提供统计边界 |
| 项目模块   | 提供项目维度 |
| 员工管理模块 | 提供工资规则 |
| 工时记录模块 | 提供基础数据 |

---

## 10. 后续可演进方向（V2+）

* 成本预算与预警
* 工时 / 成本导出（Excel）
* 成本版本化（历史工资锁定）
* 项目利润分析（收入 - 成本）

---

> ✅ 本模块设计目标：**让“干了多少活、花了多少钱”一眼可见**

---

## 九、工资结算（简化版）模块（Light Settlement）

> 本版本为 **极简结算模型**，目标是：
> 👉 只回答一句话：**现在一共要给某个员工结多少钱**。

本模块刻意不引入复杂财务概念，不与项目强绑定。

---

### 9.1 设计原则（V1 核心取舍）

* ❌ 不按项目结算

* ❌ 不关心项目是否存在未结薪资

* ❌ 不做结算单 / 明细单

* ❌ 不支持部分工时级拆分

* ✅ 只按【员工】维度结算

* ✅ 只关心【累计应结金额】

* ✅ 结算是一次性“确认归零”

> 本质上：
> **结算 = 员工层面的“已支付金额确认”**

---

### 9.2 核心结算模型

#### 1️⃣ 员工应结金额（系统实时计算）

```
员工应结金额
= 员工所有工时成本总和
- 员工已结算金额
```

其中：

* 工时成本：

  * 来自所有项目
  * 自动按薪资规则计算

---

### 9.3 员工表扩展字段

在 `employee` / `org_user` 表中增加：

| 字段             | 类型      | 说明      |
| -------------- | ------- | ------- |
| settled_amount | decimal | 累计已结算金额 |

---

### 9.4 结算操作（极简）

**结算行为定义**：

> 组织负责人确认“已向某员工支付 X 元”

系统行为：

1. 校验 X ≤ 当前应结金额
2. employee.settled_amount += X
3. 员工应结金额实时减少

> ⚠️ 不追溯具体工时、不拆项目

---

### 9.5 权限说明

| 操作       | 组织负责人 | 项目负责人 | 普通成员 |
| -------- | ----- | ----- | ---- |
| 查看员工应结金额 | ✅     | ❌     | ❌    |
| 执行结算     | ✅     | ❌     | ❌    |

---

### 9.6 为什么不需要项目级未结概念？

你的取舍是正确的，原因如下：

1. 项目只是 **成本归属维度**，不是结算主体
2. 工资最终一定是 **按员工发放**
3. 项目是否“结清”在 V1 没有实际决策价值

> 结论：
> **项目只负责“算成本”，不负责“算钱给没给”**

---

## 十、项目成本计算（再次简化确认）

项目总成本 =

```
∑ 项目内所有工时 × 对应员工薪资
+ 项目花费
```

### 10.1 项目不关心的内容（明确）

* ❌ 项目未结工资
* ❌ 项目结算状态
* ❌ 项目付款进度

项目只回答：

> **“这个项目一共花了多少钱”**

---

## 十一、项目花费（Expense）功能（轻量版）

> 用于补充项目中的 **非人力成本**，不做复杂报销流程。

---

### 10.1 设计原则

* 只做“记录 + 统计”
* 不做审批流
* 不做报销
* 不做预算控制

---

### 10.2 项目花费表（ProjectExpense）

| 字段           | 类型       | 说明               |
| ------------ | -------- | ---------------- |
| expense_id   | ID       | 花费 ID            |
| project_id   | ID       | 项目 ID            |
| amount       | decimal  | 金额               |
| category     | enum     | 类型（物料 / 外包 / 其他） |
| remark       | string   | 备注               |
| expense_date | date     | 发生日期             |
| created_by   | ID       | 记录人              |
| created_at   | datetime | 创建时间             |

---

### 10.3 项目总成本计算

项目总成本 =

```
人力成本（已结 + 未结）
+ 项目花费
```

---

## 十一、V1 明确不做

* ❌ 工资发放
* ❌ 税务
* ❌ 报销审批
* ❌ 成本预算
* ❌ 多币种

---

## 十二、总结

> **统计 → 成本 → 结算 → 花费**

这是一个清晰、可扩展、不会过度设计的路径。

V1 已具备：

* 成本可算
* 工资可结
* 项目可控

为 V2 的财务能力预留了充分空间。
